<div class="min-h-screen p-6 bg-gradient-to-br from-blue-50 via-indigo-100 to-indigo-200">
  <div class="max-w-5xl mx-auto overflow-hidden bg-white shadow-2xl rounded-2xl">

    <!-- Error Banner -->
    <div *ngIf="errorMessage" class="flex items-center justify-between p-4 mb-6 text-sm font-medium text-red-800 bg-red-100 border-l-4 border-red-500 rounded">
      <span>{{ errorMessage }}</span>
      <button (click)="errorMessage = null" class="text-xl font-bold leading-none text-red-500 hover:text-red-700">×</button>
    </div>

    <!-- Stepper -->
    <mat-horizontal-stepper #stepper linear class="p-4 bg-white rounded-lg shadow-inner">
      <mat-horizontal-stepper #stepper>
        <mat-step label="Step 1">Step 1 Content</mat-step>
        <mat-step label="Step 2">Step 2 Content</mat-step>
      </mat-horizontal-stepper>

      <!-- Step 1: Flight Search -->
      <mat-step [completed]="availableFlights.length > 0">
        <ng-template matStepLabel>
          <span class="font-semibold text-indigo-600">Flight Search</span>
        </ng-template>

        <form [formGroup]="searchForm" (ngSubmit)="onSearchFlights()" class="grid gap-4 p-6 bg-gray-50 rounded-xl">
          <mat-form-field appearance="outline">
            <mat-label>Source</mat-label>
            <input matInput formControlName="source" placeholder="e.g., Delhi">
            <mat-error *ngIf="searchForm.get('source')?.invalid">Source is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Destination</mat-label>
            <input matInput formControlName="destination" placeholder="e.g., Mumbai">
            <mat-error *ngIf="searchForm.get('destination')?.invalid">Destination is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Travel Date</mat-label>
            <input type="date" matInput formControlName="travelDate" placeholder="Select date">
            <mat-error *ngIf="searchForm.get('travelDate')?.invalid">Date is required</mat-error>
          </mat-form-field>

          <button mat-raised-button color="primary" type="submit"
                  [disabled]="searchForm.invalid || isLoading"
                  class="px-6 py-2 mt-2 text-white transition duration-200 bg-indigo-600 rounded-lg hover:bg-indigo-700">
            Search Flights
          </button>
        </form>

        <!-- Flights List -->
        <div *ngIf="availableFlights.length > 0" class="p-6 mt-4 space-y-4">
          <h3 class="text-lg font-semibold text-indigo-600">Available Flights</h3>
          <div class="grid gap-4 md:grid-cols-2">
            <mat-card *ngFor="let flight of availableFlights"
                      class="transition duration-200 border-2 border-gray-200 cursor-pointer hover:border-indigo-400 hover:shadow-lg rounded-xl"
                      (click)="selectFlight(flight)">
              <mat-card-header>
                <mat-card-title class="font-semibold text-indigo-700">
                  {{ flight.airline }} - {{ flight.flightNumber }}
                </mat-card-title>
                <mat-card-subtitle class="text-gray-500">
                  {{ flight.fromAirport }} → {{ flight.toAirport }} | {{ flight.duration }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content class="text-sm text-gray-600">
                <p>Departure: {{ flight.departureTime }} | Arrival: {{ flight.arrivalTime }}</p>
                <p>Seats: {{ flight.seatsAvailable }} | Price: <span class="font-semibold text-green-600">₹{{ flight.price }}</span></p>
                <p>Date: {{ flight.date }}</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-stroked-button color="primary" class="w-full mt-2">Select</button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
        <div matStepperNext></div>
      </mat-step>

      <!-- Step 3: Pickup Transport -->
      <mat-step [completed]="bookingData.pickupAddress">
        <ng-template matStepLabel>
          <span class="font-semibold text-indigo-600">Pre-Flight Transport</span>
        </ng-template>
        <div class="p-6">
          <h2 class="mb-4 text-2xl font-semibold text-indigo-600">Pickup from Residential Area</h2>

          <mat-form-field appearance="outline" class="w-full mb-4">
            <mat-label>Pickup Location (City)</mat-label>
            <mat-select (selectionChange)="onPickupLocationSelected($event.value)">
              <mat-option *ngFor="let loc of mockLocations" [value]="loc">{{ loc.name }}</mat-option>
            </mat-select>
          </mat-form-field>

          <div *ngIf="pickupTransports.length > 0" class="grid gap-4 md:grid-cols-3">
            <mat-radio-group (change)="selectPickupTransport($event.value)" class="w-full">
              <mat-radio-button *ngFor="let mode of pickupTransports" [value]="mode.id"
                                class="block p-3 transition border rounded-lg hover:bg-indigo-50">
                <div class="flex justify-between">
                  <span class="font-medium text-gray-700">{{ mode.name }}</span>
                  <span class="font-semibold text-green-600">₹{{ mode.price }} | {{ mode.estimatedTime }}</span>
                </div>
              </mat-radio-button>
            </mat-radio-group>
          </div>

          <div class="flex justify-between mt-6">
            <button mat-button (click)="stepper.previous()" class="px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100">Back</button>
            <button mat-raised-button color="primary" (click)="stepper.next()"
                    class="px-6 py-2 text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700">Continue</button>
          </div>
        </div>
      </mat-step>

      <!-- Step 4: Drop Transport -->
      <mat-step [completed]="bookingData.dropAddress">
        <ng-template matStepLabel>
          <span class="font-semibold text-indigo-600">Post-Flight Transport</span>
        </ng-template>
        <div class="p-6">
          <h2 class="mb-4 text-2xl font-semibold text-indigo-600">Drop to Residential Area</h2>

          <mat-form-field appearance="outline" class="w-full mb-4">
            <mat-label>Drop Location (City)</mat-label>
            <mat-select (selectionChange)="onDropLocationSelected($event.value)">
              <mat-option *ngFor="let loc of mockLocations" [value]="loc">{{ loc.name }}</mat-option>
            </mat-select>
          </mat-form-field>

          <div *ngIf="dropTransports.length > 0" class="grid gap-4 md:grid-cols-3">
            <mat-radio-group (change)="selectDropTransport($event.value)" class="w-full">
              <mat-radio-button *ngFor="let mode of dropTransports" [value]="mode.id"
                                class="block p-3 transition border rounded-lg hover:bg-indigo-50">
                <div class="flex justify-between">
                  <span class="font-medium text-gray-700">{{ mode.name }}</span>
                  <span class="font-semibold text-green-600">₹{{ mode.price }} | {{ mode.estimatedTime }}</span>
                </div>
              </mat-radio-button>
            </mat-radio-group>
          </div>

          <div class="flex justify-between mt-6">
            <button mat-button (click)="stepper.previous()" class="px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100">Back</button>
            <button mat-raised-button color="primary" (click)="stepper.next()"
                    class="px-6 py-2 text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700">Continue</button>
          </div>
        </div>
      </mat-step>

      <!-- Step 5: Ancillaries -->
      <mat-step [completed]="true">
        <ng-template matStepLabel>
          <span class="font-semibold text-indigo-600">Add Ancillaries (Optional)</span>
        </ng-template>

        <div class="p-6">
          <h2 class="mb-4 text-2xl font-semibold text-indigo-600">Enhance Your Journey</h2>

          <div class="grid gap-3 md:grid-cols-2">
            <mat-checkbox *ngFor="let anc of ancillaries"
                          (change)="toggleAncillary(anc, $event)"
                          class="w-full p-4 transition border rounded-lg shadow-sm hover:shadow-md hover:bg-indigo-50">
              <div class="flex justify-between">
                <span class="font-medium text-gray-700">{{ anc.name }} - {{ anc.description }}</span>
                <span class="font-semibold text-green-600">₹{{ anc.price }}</span>
              </div>
            </mat-checkbox>
          </div>

          <div class="p-3 mt-4 font-bold text-right text-indigo-700 bg-gray-100 rounded-lg shadow-inner">
            Subtotal: ₹{{ totalPrice }}
          </div>

          <div class="flex justify-between mt-6">
            <button mat-button (click)="stepper.previous()" class="px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100">Back</button>
            <button mat-raised-button color="primary" (click)="stepper.next()"
                    class="px-6 py-2 text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700">Continue</button>
          </div>
        </div>
      </mat-step>

      <!-- Step 6: Review & Confirm -->
      <mat-step>
        <ng-template matStepLabel>
          <span class="font-semibold text-indigo-600">Review & Confirm</span>
        </ng-template>

        <div class="p-6">
          <mat-card class="p-4 border shadow-lg rounded-xl">
            <mat-card-header>
              <mat-card-title class="text-xl font-semibold text-indigo-700">Review Your Booking</mat-card-title>
            </mat-card-header>

            <mat-card-content class="space-y-4">
              <div *ngIf="!selectedFlight" class="flex items-center gap-2 font-medium text-red-600">
                <mat-icon>error</mat-icon> Please select a flight to review.
              </div>

              <div *ngIf="selectedFlight" class="space-y-3 text-gray-700">
                <div>
                  <h3 class="font-semibold text-indigo-600">Flight</h3>
                  <p>{{ selectedFlight.airline }} - {{ selectedFlight.flightNumber }}</p>
                  <p>{{ selectedFlight.fromAirport }} → {{ selectedFlight.toAirport }} on {{ selectedFlight.date }}</p>
                  <p class="font-semibold text-green-600">₹{{ selectedFlight.price }}</p>
                </div>

                <div>
                  <h3 class="font-semibold text-indigo-600">Pickup & Drop</h3>
                  <p>Pickup: {{ bookingData.pickupAddress || 'N/A' }} via {{ bookingData.pickupMode || 'N/A' }} (₹{{ bookingData.pickupPrice || 0 }})</p>
                  <p>Drop: {{ bookingData.dropAddress || 'N/A' }} via {{ bookingData.dropMode || 'N/A' }} (₹{{ bookingData.dropPrice || 0 }})</p>
                </div>

                <div>
                  <h3 class="font-semibold text-indigo-600">Extras</h3>
                  <p>Seat: {{ bookingData.seatType || 'Economy' }} (₹{{ bookingData.seatPrice || 0 }})</p>
                  <p>Ancillaries: {{ (bookingData.ancillaries || []).join(', ') || 'None' }} (₹{{ bookingData.ancillaryPrice || 0 }})</p>
                </div>

                <div class="pt-3 text-lg font-bold text-right text-indigo-700 border-t">
                  Total: ₹{{ totalPrice }}
                </div>

                <button mat-raised-button color="primary" (click)="confirmBooking()"
                        class="w-full py-2 mt-3 text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700">
                  <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                  {{ isLoading ? 'Confirming...' : 'Confirm Booking' }}
                </button>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
</div>
